# 設計資料庫表格時常見的錯誤
- 直接將某張表單設計成表格
- 直接將ER Diagram中所有的個體及屬性設計為表格

# 沒有正規化的後果
- 容易有不必要的資料儲存
- 資料在做**插入**、**刪除**及**更新**動作時，容易產生異常
- 會發生這些問題，是因為同一份表格內的屬性之間，有許多**功能相依性**存在

# 正規化的目的
- 降低資料重複性
- 避免更新、插入及刪除造成的異常

# 功能相依性
> 定義：假如R(A1,A2...,An)代表一個關聯，其中X與Y為關聯R中屬性的子集合，則**Y功能相依於X**，可寫成符號 ```X→Y``` (X決定Y)。  
```
                 ┌─────┐
                 │     ↓
       R(A1, ... X ... Y, An)
```
> 其中，X為**決定因素**，Y為**相依因素**。

舉例：所在地決定區碼、地址決定郵遞區號、員工編號決定員工姓名
- 特性：關聯R中的X若為主鍵，則關聯R中所有其他的屬性必定功能相依於X


# Trival 及 Non-Trival 功能相依性
- 沒價值
    - 若功能相依性右邊的相依因素為左邊決定因素的部分集合時，稱此功能相依為Trival(沒價值)
    - 例如：{A,B} → A
- 非沒價值
    - 若功能相依性右邊的相依因素非左邊決定因素的部分集合，稱此功能相依為Non-Trival(非沒價值)
    - 例如：{A,B} → C
    - Non-Trival對於正規化才有意義

# 功能相依性的種類
- 完全功能相依
    - 若主鍵是由多個屬性構成，且某非鍵值屬性依賴主鍵的全部而非部分時，稱該屬性完全功能相依於主鍵
    - 若主鍵僅由一個屬性組成，則任一非鍵值屬性必定功能相依於主鍵
- 部分功能相依
    - 若主鍵是由多個屬性組成，而非鍵值屬性是依賴主鍵之部分屬性時，則稱該非鍵值屬性部分相依於主鍵
- 遞移相依
    - 若存在一個非鍵值屬性T，使得I->T且T->J的功能相依均成立，則稱屬性I與J之間具有遞移相依
    ```
       ┌────┐
      ┌┴┐   ↓ 
    R(x,y,z,a,b,c)
            │ ↑
            └─┘ 
    ```

# 鍵值屬性
- 能構成主鍵或候選鍵的所有屬性
- 反之，則稱為非鍵值屬性

# 阿姆斯壯定理
- 反身性：若B是A的子集合，則A->B
- 擴張性：若A->B，則AC->BC
- 遞移性：若A->B且B->C，則A->C
- 自身決定性：A->A
- 分解性:A->BC，則A->B且A->C
- 聯集性：若A->B且A->C，則A->BC
- 合成性：若A->B且C->D，則AC->BD
- 虛擬遞移性：若A->B且BC->D，則AC->D

# 正規化過程

```
   未正規化的關聯
        |
        |--------->除去非單元性的資料項目(沒有陣列產生)
        ↓
   第一正規化 1NF 
        |
        |--------->除去部分功能相依性
        ↓
   第二正規化 2NF
        |
        |--------->除去遞移相依性
        ↓
   第三正規化 3NF     
        |
        |--------->去除其他功能相依性所引起的異常
        ↓
   Boyce-Codd正規化 BCNF      
```

# 過度的正規化
表格經由正規化分割愈細，愈可以避免資料重複及更新異常，但也是有一些副作用
- 查詢或過度使用Join運算，降低效率
- 有可能產生**有損分解**

# 第一正規化
- 要符合，關聯表中每個屬性都為單元值，不可分割性。
- 作法：
    - 多值屬性 -> 分解成多個職組
    - 複合屬性 -> 拆為簡單屬性
- 問題：產生資料重複性
    - 需透過更細的正規化來降低重複性

# 第二正規化
- 要符合，所有非鍵值屬性皆完全功能相依於主鍵
- 作法：
    - 將部分相依於主鍵之非鍵值屬性取出，並與所屬之決定因素建立新的關聯，並將相依因素自原關聯刪除
    - 決定外來鍵
    ![](http://i.imgur.com/ADt35eZ.png)
    ![](http://i.imgur.com/FsRud5U.png)

# 第三正規化
- 要符合，不存在非鍵值屬性遞移相依於主鍵(即非鍵值屬性之間不存在功能相依)
- 作法
    - 將遞移相依中，非鍵值之決定因素與相依因素取出，建立新的關聯，並將相依因素自原關聯中刪除
    - 決定外來鍵
    - ![](http://i.imgur.com/p9vhkQp.png)

# BCNF
- 3NF改良版
- 要符合，功能相依性之決定因素都是候選鍵
- 如果主鍵為單一屬性時，就不需考慮此情況
- 滿足1NF,2NF,3NF不滿足BCNF的情況![](http://i.imgur.com/3zxqAeI.png)
    - 滿足3NF：B事主鍵的一部分
    - 不滿足BCNF：有一個決定因素C不為候選鍵